otype.Uq=function(){return Gr(this,1)};Wfq.prototype.gv=function(){return Ir(this,2)};Wfq.Ic=Tfq;function Yfq(a){Or.call(this,a)}G(Yfq,Or);Yfq.prototype.Uq=function(){return this.aa.Uq()};Yfq.prototype.gv=function(){return this.aa.gv()};function Zfq(a){this.Xb=a}G(Zfq,Dr);Zfq.prototype.tc=function(){return new $fq(this)};Zfq.Ic=Vfq;function $fq(a){Or.call(this,a)}G($fq,Or);function agq(){}G(agq,J);agq.prototype.load=function(a){es(null==this.aa,"Comments secret is already set.");this.aa=a};agq.prototype.replace=function(a){es(null!=a,"Comments secret should not be replaced with null.");this.aa=a};function bgq(a){this.aa=a}G(bgq,J);bgq.prototype.fetch=function(a){var c=a.getId();return this.aa.getUrl(c.getId()).transform(function(d){return new nx(c,d,ePa)})};function cgq(a,c){Ku.call(this,a,c);this.aa(Error(this))}G(cgq,Ku);function dgq(){}G(dgq,J);function egq(a,c,d,e,f,g,h,l,m,n,q,r,v,w){this.ma=this.na=this.oa=this.aa=!1;this.qa=a;this.ga=c;this.Fa=d;this.za=e;this.Ma=f;this.la=h;this.va=l;this.Ba=m;this.Aa=v;this.La=w;this.ea=new Xu;this.wa(this.ea);g?(a=new dgq,a.ga=[],a.aa=g,g=a):g=null;this.ha=g;this.ia={};this.oa=!1;this.na=!0;this.ma=!1}G(egq,Mu);egq.prototype.load=function(a){var c=Su();fgq(this,c);this.ga.fetch(a);return c};
function fgq(a,c){a.ea.Pa(a.ga.La,function(d){d=d.aa;RJp!==d.tR()&&ggq(a,c,Lu("Found invalid encryption type for the blob: "+M(d.tR())));vOa!==d.getContentType()&&ggq(a,c,Lu("Found invalid content type for the blob: "+M(d.getContentType())))});a.ea.Pa(a.ga.xb,function(d){var e=d.aa.ea;var f=(f=d.aa.ga)?[Lv(f),bhb(f)]:null;var g=null;(d=d.aa.aa)?(a.va.load(d.ea),g=d.aa):a.va.load(null);null==g&&(g=hgq());es(!!g,"Comments secret must be valid.");a.Ba.load(g);a.qa.za(2,null,e,e,f,null,null)});a.ea.Pa(a.ga.lb,
function(d){a.oa=!0;var e=d.aa;if(a.na||!a.ha)a.qa.oa(e);else if(d instanceof qfq){d=d.ea;null==a.la&&(a.la=d);var f=a.ha;null==f.ea||K(f.ea,d)||(f.aa.aa(f.ea,f.ga),f.ga=[]);for(var g=f.ga,h=0,l=e.length;h<l;h=h+1|0)g.push(e[h]);f.ea=d;f=a.ha.aa;null==f.ga()&&K(d,a.la)&&(f.ia(a.la),f.ha(e),igq(a))}else for(e=Rv(a.Aa,e),d=0;d<e.length;d++)a.La.iM(e[d],!0,!1);a.na=!1});a.ea.Pa(a.ga.pb,function(d){var e=[];d=d.aa;for(var f=0;f<d.length;f++){var g=d[f],h=Su();kt(a.ia,g,h);var l=e;g=jgq(a.Fa,g,h);l.push(g)}kgq(a.za,
e)});a.ea.Pa(a.ga.Fa,function(d){var e=d.ea;d=d.aa;var f=a.ia[e];nt(a.ia,e);f.callback(d)});a.ea.Pa(a.ga.Ma,function(){if(a.ha){var d=a.ha;null!=d.ea&&d.aa.aa(d.ea,d.ga);d.aa.ea()}igq(a)});a.ea.Pa(a.ga.qa,function(){if(0<it(a.ia)){for(var d in a.ia)a.ia[d].errback(Lu("Missing bytes in CSE blob for image id: "+M(d)));ggq(a,c,Lu("There are still images waiting to be fetched from CSE blob for load."))}else a.ha&&a.ha.aa.la(),a.ea.ld(),c.callback(null)});a.ea.Pa(a.ga.Aa,p());a.ea.Pa(a.ga.Za,p());a.ea.Pa(a.ga.Ab,
function(d){ggq(a,c,d.aa)});a.ea.Pa(a.ga.Yc,p())}function igq(a){a.ma||(a.ma=!0,a.qa.la())}function ggq(a,c,d){if(a.oa){var e=a.Ma,f=(Tx(),Axb);e.setState(f,null,null)}a.ea.ld();c.errback(d)};function hgq(){var a=new D7g(new Kaq),c=a.aa;var d=new Uint8Array(32);crypto.getRandomValues(d);d=Array.from(d);for(var e="",f=0;f<d.length;f=f+1|0)e=M(e)+Po(d[f]&65535);c.call(a,e);return a.digest()};function lgq(){}G(lgq,J);function mgq(a,c,d,e,f,g){this.aa=!1;this.la=a;this.ia=c;this.na=d;this.qa=e;this.oa=f;this.ma=g;this.ha=!1;this.ga=new Wu;this.wa(this.ga)}G(mgq,Mu);B=mgq.prototype;B.BU=function(){return Pu(this.la)&&!ngq(this.la.getValue())};B.Bsa=u(Kg);B.GKa=u(sf);
B.IKa=function(a,c){var d=this;if(!this.BU())return!1;if(ss(a))return!0;this.ea=Tw(this.qa,"cs");this.oa.recordImpression(30106,null);var e=(new Fv).wb(19);this.la.getValue().save(c).wd(function(){ds(1==a.length);var f=a[0];X2f(d.ia,zx(d.ia)+1|0,null,f.getRequestId(),f.aa);f=d.ea;var g=f.complete;var h=L6p(!0);h=Oq(h,4,!d.ha);g.call(f,ggb(e,h).build());d.ea=null;f=(new Fv).wb(19);g=new Ceb;h=a[0].getCommands().length;g=Qq(g,1,h);f=ggb(f,g).build();$v(xoa).fireAction(null,f);d.ma.dispatchEvent(new C3f)},
function(){c3f(d.ia);qx(d.na.ga,DQa);var f=d.ea,g=f.complete;var h=L6p(!1);h=Oq(h,4,!d.ha);g.call(f,ggb(e,h).build());d.ea=null;d.ga.dispatchEvent(new aqg(!0,!0,{},null))});return this.ha=!0};B.N$a=x(!1);B.HKa=function(){var a={},c=this.BU();a.clientSaveCommandTransporter_canTransportCommands=c;return a};function ogq(){this.ea=0}G(ogq,fo);function pgq(a,c,d){var e=new ogq;e.ga=a;e.ea=c;e.aa=d;return e}var qgq=pgq(iea,0,iea),rgq=pgq("SERIALIZE",1,"SERIALIZE"),sgq=pgq("SIZE",2,"SIZE"),tgq=pgq("EXPORT",3,"EXPORT"),ugq=pgq(EVe,4,EVe);function vgq(a,c,d,e,f,g,h,l,m){this.ga=a;this.ha=c;this.ma=d;this.la=e;this.na=f;this.ia=g;this.qa=h;this.oa=l;this.aa=qgq;this.ea=m}G(vgq,J);function ngq(a){return!K(a.aa,qgq)&&!K(a.aa,ugq)}
vgq.prototype.save=function(a){var c=this;es(K(this.aa,qgq),"Cannot start a client save if another is in progress or previously failed");var d=lTb(this.ga,"csfr"),e=lTb(this.ga,"csotfr"),f=Ru(Ru(vX(function(){var g;c.aa=rgq;return c.la.ob(c.ma.getModel(),(g=c.na,g(a)).getValue())}),function(g){c.aa=sgq;return wgq(c.oa,c.qa.validate(g)).transform(function(){return g.aa})}),function(g){e.stop();c.aa=tgq;return c.ia.ea(g)}).transform(function(){d.stop();c.aa=qgq;return null});f.eh(function(g){ds(!K(c.aa,
qgq)&&!K(c.a